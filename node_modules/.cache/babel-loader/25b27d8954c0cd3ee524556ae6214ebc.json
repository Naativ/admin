{"remainingRequest":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js!/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/narfdre/Code/hexly/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/narfdre/Code/hexly/admin/src/views/assets/AssetList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/narfdre/Code/hexly/admin/src/views/assets/AssetList.vue","mtime":1559148307000},{"path":"/Users/narfdre/Code/hexly/admin/.babelrc","mtime":1546923832000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport AssetDialog from '@/content/AssetDialog.vue';\nimport { processingStatus } from '@/content/content.gql.js';\nimport { mapActions, mapGetters } from 'vuex';\nimport { ContentActions, ContentGetters } from '@/content/ContentStore';\nexport default {\n  name: 'Assets',\n  components: {\n    AssetDialog: AssetDialog\n  },\n  data: function data() {\n    return {\n      showAssetDialog: false,\n      selectedAsset: {},\n      statuses: {\n        200: 'Available',\n        202: 'Pending',\n        203: 'Processing',\n        204: 'Failed',\n        301: 'Archived'\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.assets.forEach(\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(_) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (_this.isPending(_)) {\n                  _this.refresh(_);\n                }\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  },\n  props: {\n    assets: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    manage: {\n      type: Boolean,\n      default: false\n    },\n    profile: {\n      type: Array\n    },\n    profilePic: {\n      type: Number\n    }\n  },\n  computed: _objectSpread({}, mapGetters({\n    assetMeta: ContentGetters.assetMeta\n  })),\n  methods: _objectSpread({}, mapActions({\n    setTags: ContentActions.ADD_ASSET_TAG,\n    removeAsset: ContentActions.REMOVE_ASSET\n  }), {\n    filterTags: function filterTags(asset, key) {\n      if (asset.tags === null) {\n        return false;\n      }\n\n      return asset.tags.filter(function (_) {\n        return _.key.indexOf(key) > -1;\n      }).map(function (_) {\n        return _.name;\n      });\n    },\n    showAsset: function showAsset(asset) {\n      this.showAssetDialog = true;\n      this.selectedAsset = asset;\n    },\n    closeAssetDialog: function closeAssetDialog() {\n      this.showAssetDialog = false;\n      this.selectedAsset = {};\n    },\n    addTag: function () {\n      var _addTag = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(asset, tag) {\n        var tagData, pendingData, filteredTags;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                tagData = this.assetMeta.approval.find(function (e) {\n                  return e.key === \"approval:\".concat(tag);\n                });\n                pendingData = this.assetMeta.approval.find(function (e) {\n                  return e.key === \"approval:pending\";\n                });\n                filteredTags = asset.tags.filter(function (_) {\n                  return _.id !== pendingData.id;\n                });\n                _context2.next = 5;\n                return this.setTags({\n                  asset: asset,\n                  tags: [].concat(_toConsumableArray(filteredTags.map(function (_) {\n                    return _.id;\n                  })), [tagData.id])\n                });\n\n              case 5:\n                _context2.next = 7;\n                return this.removeAsset(asset);\n\n              case 7:\n                this.$emit('tagAdded', asset);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function addTag(_x2, _x3) {\n        return _addTag.apply(this, arguments);\n      }\n\n      return addTag;\n    }(),\n    refresh: function () {\n      var _refresh = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(_asset) {\n        var _this2 = this;\n\n        var _ref2, data, asset;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.$apollo.query({\n                  query: processingStatus,\n                  variables: {\n                    input: {\n                      assetId: _asset.id\n                    }\n                  },\n                  fetchPolicy: 'network-only'\n                });\n\n              case 2:\n                _ref2 = _context3.sent;\n                data = _ref2.data;\n                asset = data.assetProcessingStatus.asset;\n                if (asset) this.$emit('updated', asset);\n\n                if (this.isPending(asset)) {\n                  window.setTimeout(function () {\n                    _this2.refresh(asset);\n                  }, 15 * 1000);\n                }\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function refresh(_x4) {\n        return _refresh.apply(this, arguments);\n      }\n\n      return refresh;\n    }(),\n    isPending: function isPending(asset) {\n      return [202, 203].indexOf(asset.visibilityId) > -1;\n    }\n  }),\n  watch: {\n    assets: function assets(val) {\n      var _this3 = this;\n\n      val.forEach(\n      /*#__PURE__*/\n      function () {\n        var _ref3 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee4(_) {\n          return regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  if (_this3.isPending(_)) {\n                    _this3.refresh(_);\n                  }\n\n                case 1:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function (_x5) {\n          return _ref3.apply(this, arguments);\n        };\n      }());\n    }\n  }\n};",{"version":3,"sources":["AssetList.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout row wrap>\n    <AssetDialog\n      :showAssetDialog=\"showAssetDialog\"\n      :asset=\"this.selectedAsset\"\n      @closeAssetDialog=\"closeAssetDialog\"\n    />\n    <v-flex xs12 sm6 md4 lg3 xl2 pa-1 v-for=\"(asset, index) in assets\" :key=\"index\">\n      <v-card>\n        <div v-if=\"isPending(asset)\" class=\"v-responsive v-image bordered\">\n          <div class=\"v-responsive__sizer\" style=\"padding-bottom: 36.3636%;\"></div>\n          <div class=\"v-image__image v-image__image--cover image-missing\">\n            <strong>File is still processing</strong>\n          </div>\n          <div class=\"v-responsive__content\"></div>\n        </div>\n        <div v-else-if=\"asset.visibilityId === 204\" class=\"v-responsive v-image bordered\">\n          <div class=\"v-responsive__sizer\" style=\"padding-bottom: 36.3636%;\"></div>\n          <div class=\"v-image__image v-image__image--cover image-missing\">Failed. Please try reporcessing</div>\n          <div class=\"v-responsive__content\"></div>\n        </div>\n        <v-img v-else-if=\"asset.thumbnailUrl\" :src=\"asset.thumbnailUrl\" aspect-ratio=\"2.75\"></v-img>\n        <v-img\n          v-else-if=\"asset.url && asset.categoryKey === 'image'\"\n          :src=\"asset.url\"\n          aspect-ratio=\"2.75\"\n        ></v-img>\n        <div v-else-if=\"asset.categoryKey === 'doc'\" class=\"v-responsive v-image bordered\">\n          <v-spacer/>\n          <object :data=\"asset.url\" type=\"application/pdf\">\n            <embed v-if=\"!$browser.isMobile\" :src=\"asset.url\" type=\"application/pdf\" target=\"_blank\"/>\n            <p class=\"pdf\">Preview not available</p>\n          </object>\n          <v-spacer />\n        </div>\n        <div v-else class=\"v-responsive v-image bordered\">\n          <div class=\"v-responsive__sizer\" style=\"padding-bottom: 36.3636%;\"></div>\n          <div class=\"v-image__image v-image__image--cover image-missing\">Preview not available</div>\n          <div class=\"v-responsive__content\"></div>\n        </div>\n        <v-card-title primary-title style=\"overflow: hidden;\">\n          <div>\n            <v-chip class=\"profile-chip\" v-if=\"profile && inProfile(asset)\" color=\"green\" text-color=\"white\">In Profile</v-chip>\n            <v-chip class=\"profile-chip\" v-if=\"profile && asset.id === profilePic\" color=\"green\" text-color=\"white\">Profile Pic</v-chip>\n            <h3 class=\"headline mb-0\" style=\"text-overflow: ellipsis;\">{{asset.name}}</h3>\n            <div>\n              <small>{{asset.owner.displayName}} (#{{asset.owner.mrn}})</small>\n              <div v-if=\"filterTags(asset, 'search').length\">\n                <small>Tags: </small>\n                <small>{{filterTags(asset, 'search').join(', ')}}</small>\n              </div>\n              <div v-if=\"filterTags(asset, 'aud').length\">\n                <small>Audience: </small>\n                <small>{{filterTags(asset, 'aud').join(', ')}}</small>\n              </div>\n            </div>\n            <div style=\"height: 50px;\">{{asset.description}}</div>\n          </div>\n        </v-card-title>\n        <v-card-actions>\n          <v-btn flat color=\"primary\" :disabled=\"asset.visibilityId !== 200\" @click=\"showAsset(asset)\">Show</v-btn>\n          <v-btn flat disabled>{{statuses[asset.visibilityId]}}</v-btn>\n          <v-spacer></v-spacer>\n          <v-menu transition=\"slide-y-transition\" bottom>\n            <v-btn fab flat slot=\"activator\">\n              <v-icon>more_vert</v-icon>\n            </v-btn>\n            <v-list>\n              <v-list-tile @click=\"addTag(asset, 'approved')\">\n                <v-list-tile-title>Approve</v-list-tile-title>\n              </v-list-tile>\n              <v-list-tile @click=\"addTag(asset, 'rejected')\">\n                <v-list-tile-title>Reject</v-list-tile-title>\n              </v-list-tile>\n            </v-list>\n          </v-menu>\n        </v-card-actions>\n      </v-card>\n    </v-flex>\n  </v-layout>\n</template>\n\n<script>\nimport AssetDialog from '@/content/AssetDialog.vue'\nimport { processingStatus } from '@/content/content.gql.js'\n\nimport { mapActions, mapGetters } from 'vuex'\nimport { ContentActions, ContentGetters } from '@/content/ContentStore'\nexport default {\n  name: 'Assets',\n  components: {\n    AssetDialog\n  },\n  data() {\n    return {\n      showAssetDialog: false,\n      selectedAsset: {},\n      statuses: {\n        200: 'Available',\n        202: 'Pending',\n        203: 'Processing',\n        204: 'Failed',\n        301: 'Archived'\n      }\n    }\n  },\n  mounted() {\n    this.assets.forEach(async _ => {\n      if (this.isPending(_)) {\n        this.refresh(_)\n      }\n    })\n  },\n  props: {\n    assets: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    manage: {\n      type: Boolean,\n      default: false\n    },\n    profile: {\n      type: Array\n    },\n    profilePic: {\n      type: Number\n    }\n  },\n  computed: {\n    ...mapGetters({\n      assetMeta: ContentGetters.assetMeta\n    })\n  },\n  methods: {\n    ...mapActions({\n      setTags: ContentActions.ADD_ASSET_TAG,\n      removeAsset: ContentActions.REMOVE_ASSET\n    }),\n    filterTags(asset, key) {\n      if (asset.tags === null) { return false }\n      return asset.tags.filter(_ => _.key.indexOf(key) > -1).map(_ => _.name)\n    },\n    showAsset(asset) {\n      this.showAssetDialog = true\n      this.selectedAsset = asset\n    },\n    closeAssetDialog() {\n      this.showAssetDialog = false\n      this.selectedAsset = {}\n    },\n    async addTag(asset, tag) {\n      const tagData = this.assetMeta.approval.find(e => e.key === `approval:${tag}`)\n      const pendingData = this.assetMeta.approval.find(e => e.key === `approval:pending`)\n      const filteredTags = asset.tags.filter(_ => _.id !== pendingData.id)\n      await this.setTags({\n        asset,\n        tags: [\n          ...filteredTags.map(_ => _.id),\n          tagData.id\n        ]\n      })\n      await this.removeAsset(asset)\n      this.$emit('tagAdded', asset)\n    },\n    async refresh(_asset) {\n      const { data } = await this.$apollo.query({\n        query: processingStatus,\n        variables: {\n          input: {\n            assetId: _asset.id\n          }\n        },\n        fetchPolicy: 'network-only'\n      })\n\n      const { asset } = data.assetProcessingStatus\n      if (asset) this.$emit('updated', asset)\n      if (this.isPending(asset)) {\n        window.setTimeout(() => { this.refresh(asset) }, 15 * 1000)\n      }\n    },\n    isPending(asset) {\n      return [202, 203].indexOf(asset.visibilityId) > -1\n    }\n  },\n  watch: {\n    assets(val) {\n      val.forEach(async _ => {\n        if (this.isPending(_)) {\n          this.refresh(_)\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.bordered {\n  border-bottom: 1px solid #eee;\n}\n.image-missing {\n  text-align: center;\n  margin: auto;\n  position: relative;\n  height: 100%;\n}\n.pdf {\n  margin: 15px 0;\n}\n.profile-chip{\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n</style>\n"],"sourceRoot":"src/views/assets"}]}