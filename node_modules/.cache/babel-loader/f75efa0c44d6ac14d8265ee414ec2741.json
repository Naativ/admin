{"remainingRequest":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js!/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/narfdre/Code/hexly/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/narfdre/Code/hexly/admin/src/views/curriculum/Units.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/narfdre/Code/hexly/admin/src/views/curriculum/Units.vue","mtime":1570835920000},{"path":"/Users/narfdre/Code/hexly/admin/.babelrc","mtime":1546923832000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport AddDialog from '@/components/courses/AddDialog.vue';\nimport { mapActions } from 'vuex';\nimport { uploadUnitForm } from '@/components/courses/forms';\nimport { CurriculumActions } from '@/curriculum/CurriculumStore';\nimport Sortable from 'sortablejs';\nexport default {\n  components: {\n    AddDialog: AddDialog\n  },\n  data: function data() {\n    return {\n      headers: [{\n        text: '',\n        sortable: false\n      }, {\n        text: 'Priority',\n        value: 'priority'\n      }, {\n        text: 'ID',\n        value: 'id',\n        sortable: false\n      }, {\n        text: 'Course ID',\n        value: 'unit_id',\n        sortable: false\n      }, {\n        text: 'Key',\n        value: 'key',\n        sortable: false\n      }, {\n        text: 'Name',\n        value: 'name',\n        sortable: false\n      }, {\n        text: 'Description',\n        value: 'description',\n        sortable: false\n      }, {\n        text: 'Modified By',\n        value: 'modified_by',\n        sortable: false\n      }],\n      units: [],\n      orderChanged: false,\n      loading: false,\n      showDialog: false,\n      unitForm: uploadUnitForm,\n      pageLoading: true\n    };\n  },\n  mounted: function () {\n    var _mounted = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var _ref, results, table;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return this.getUnits([this.courseId]);\n\n            case 2:\n              _ref = _context.sent;\n              results = _ref.results;\n              this.units = results.map(function (u) {\n                return _objectSpread({}, u);\n              }).sort(function (a, b) {\n                return a.priority - b.priority;\n              });\n              this.pageLoading = false;\n              table = document.querySelector('.v-datatable tbody');\n              Sortable.create(table, {\n                onEnd: this.updateUnits,\n                handle: '.sortHandle'\n              });\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function mounted() {\n      return _mounted.apply(this, arguments);\n    }\n\n    return mounted;\n  }(),\n  computed: {\n    courseId: function courseId() {\n      return ~~this.$route.params.courseId ? ~~this.$route.params.courseId : '';\n    }\n  },\n  methods: _objectSpread({}, mapActions([CurriculumActions.GET_UNITS, CurriculumActions.UPSERT_UNIT]), {\n    saveOrder: function () {\n      var _saveOrder = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this = this;\n\n        var test;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.loading = true;\n                test = _toConsumableArray(this.units);\n                _context2.next = 4;\n                return test.forEach(function (row) {\n                  _this.upsertUnit(row);\n                });\n\n              case 4:\n                this.loading = false;\n                this.orderChanged = false;\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function saveOrder() {\n        return _saveOrder.apply(this, arguments);\n      }\n\n      return saveOrder;\n    }(),\n    updateUnits: function updateUnits(_ref2) {\n      var _this2 = this;\n\n      var newIndex = _ref2.newIndex,\n          oldIndex = _ref2.oldIndex;\n      this.orderChanged = true;\n\n      var test = _toConsumableArray(this.units);\n\n      this.units = [];\n      var rowSelected = test.splice(oldIndex, 1)[0];\n      test.splice(newIndex, 0, rowSelected);\n      test.forEach(function (t, index) {\n        t.priority = index;\n        return t;\n      });\n      this.$nextTick(function () {\n        _this2.units = _toConsumableArray(test);\n      });\n    },\n    openDialog: function openDialog() {\n      this.showDialog = true;\n    },\n    closeDialog: function () {\n      var _closeDialog = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(val) {\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.showDialog = false;\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function closeDialog(_x) {\n        return _closeDialog.apply(this, arguments);\n      }\n\n      return closeDialog;\n    }(),\n    openBlock: function openBlock(unitId) {\n      this.$router.push('/curriculum/courses/' + this.courseId + '/unit/' + unitId);\n    },\n    submitForm: function () {\n      var _submitForm = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(val) {\n        var _this3 = this;\n\n        var _ref3, results;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                val.courseId = this.courseId;\n                _context4.next = 3;\n                return this.upsertUnit(val);\n\n              case 3:\n                Object.keys(this.unitForm).forEach(function (index) {\n                  _this3.unitForm[index] = '';\n                });\n                delete this.unitForm.courseId;\n                this.showDialog = false;\n                _context4.next = 8;\n                return this.getUnits([this.courseId]);\n\n              case 8:\n                _ref3 = _context4.sent;\n                results = _ref3.results;\n                this.units = results.map(function (u) {\n                  return _objectSpread({}, u);\n                }).sort(function (a, b) {\n                  return a.priority - b.priority;\n                });\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function submitForm(_x2) {\n        return _submitForm.apply(this, arguments);\n      }\n\n      return submitForm;\n    }()\n  })\n};",{"version":3,"sources":["Units.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout justify-space-around align-center column>\n    <v-progress-circular v-if=\"pageLoading\" color=\"blue\" indeterminate></v-progress-circular>\n    <h3>Units for Course {{courseId}} </h3>\n    <v-container class=\"table\">\n      <v-btn @click=\"openDialog\" color=\"pink\" dark absolute right fab>\n        <v-icon>add</v-icon>\n      </v-btn>\n      <v-data-table\n        must-sort\n        :items=\"units\"\n        :headers=\"headers\"\n        hide-actions\n      >\n      <template slot=\"items\" slot-scope=\"props\">\n        <tr @click=\"openBlock(props.item.id)\">\n          <td class=\"px-1\" style=\"width: 0.1%\">\n            <v-btn style=\"cursor: move\" icon class=\"sortHandle\"><v-icon>drag_handle</v-icon></v-btn>\n          </td>\n          <td class=\"text-xs\">{{ props.item.priority}}</td>\n          <td class=\"text-xs\">{{ props.item.id}}</td>\n          <td class=\"text-xs\">{{ props.item.courseId}}</td>\n          <td class=\"text-xs\">{{ props.item.key}}</td>\n          <td class=\"text-xs\">{{ props.item.name}}</td>\n          <td class=\"text-xs\">{{ props.item.description}}</td>\n          <td class=\"text-xs\">{{ props.item.modifiedBy}}</td>\n        </tr>\n      </template>\n      </v-data-table>\n    </v-container>\n    <AddDialog\n      :showDialog=\"showDialog\"\n      :uploadConfig=\"unitForm\"\n      @closeDialog=\"closeDialog\"\n      @submitForm=\"submitForm\"\n      dialogTitle=\"Unit\"\n    />\n    <v-btn\n      v-if=\"orderChanged\"\n      :loading=\"loading\"\n      @click=\"saveOrder\"\n    >\n      Update Priority\n    </v-btn>\n  </v-layout>\n</template>\n\n<script>\nimport AddDialog from '@/components/courses/AddDialog.vue'\n\nimport { mapActions } from 'vuex'\nimport { uploadUnitForm } from '@/components/courses/forms'\nimport { CurriculumActions } from '@/curriculum/CurriculumStore'\n\nimport Sortable from 'sortablejs'\n\nexport default {\n  components: {\n    AddDialog\n  },\n  data() {\n    return {\n      headers: [\n        { text: '', sortable: false },\n        { text: 'Priority', value: 'priority' },\n        { text: 'ID', value: 'id', sortable: false },\n        { text: 'Course ID', value: 'unit_id', sortable: false },\n        { text: 'Key', value: 'key', sortable: false },\n        { text: 'Name', value: 'name', sortable: false },\n        { text: 'Description', value: 'description', sortable: false },\n        { text: 'Modified By', value: 'modified_by', sortable: false }\n      ],\n      units: [],\n      orderChanged: false,\n      loading: false,\n      showDialog: false,\n      unitForm: uploadUnitForm,\n      pageLoading: true\n    }\n  },\n  async mounted() {\n    const { results } = await this.getUnits([this.courseId])\n    this.units = results.map(u => { return { ...u } }).sort(function(a, b) {\n      return a.priority - b.priority\n    })\n\n    this.pageLoading = false\n    const table = document.querySelector('.v-datatable tbody')\n    Sortable.create(table, {\n      onEnd: this.updateUnits,\n      handle: '.sortHandle'\n    })\n  },\n  computed: {\n    courseId() {\n      return ~~this.$route.params.courseId ? ~~this.$route.params.courseId : ''\n    }\n  },\n  methods: {\n    ...mapActions([CurriculumActions.GET_UNITS, CurriculumActions.UPSERT_UNIT]),\n    async saveOrder() {\n      this.loading = true\n      const test = [ ...this.units ]\n      await test.forEach(row => {\n        this.upsertUnit(row)\n      })\n      this.loading = false\n      this.orderChanged = false\n    },\n    updateUnits({ newIndex, oldIndex }) {\n      this.orderChanged = true\n      var test = [...this.units]\n      this.units = []\n      const rowSelected = test.splice(oldIndex, 1)[0]\n      test.splice(newIndex, 0, rowSelected)\n      test.forEach((t, index) => {\n        t.priority = index\n        return t\n      })\n      this.$nextTick(() => {\n        this.units = [...test]\n      })\n    },\n    openDialog() {\n      this.showDialog = true\n    },\n    async closeDialog(val) {\n      this.showDialog = false\n    },\n    openBlock(unitId) {\n      this.$router.push('/curriculum/courses/' + this.courseId + '/unit/' + unitId)\n    },\n    async submitForm(val) {\n      val.courseId = this.courseId\n      await this.upsertUnit(val)\n\n      Object.keys(this.unitForm).forEach(index => {\n        this.unitForm[index] = ''\n      })\n      delete this.unitForm.courseId\n\n      this.showDialog = false\n      const { results } = await this.getUnits([this.courseId])\n      this.units = results.map(u => { return { ...u } }).sort(function(a, b) {\n        return a.priority - b.priority\n      })\n    }\n  }\n}\n</script>\n\n<style>\n.table {\n  text-align: left !important;\n}\n</style>\n"],"sourceRoot":"src/views/curriculum"}]}