{"remainingRequest":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js!/Users/narfdre/Code/hexly/admin/node_modules/eslint-loader/index.js??ref--13-0!/Users/narfdre/Code/hexly/admin/src/store.js","dependencies":[{"path":"/Users/narfdre/Code/hexly/admin/src/store.js","mtime":1570835920000},{"path":"/Users/narfdre/Code/hexly/admin/.babelrc","mtime":1546923832000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/narfdre/Code/hexly/admin/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/narfdre/Code/hexly/admin/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\n\nvar _mutations, _actions, _getters;\n\nimport Vue from 'vue';\nimport Vuex from 'vuex';\nimport axios from 'axios';\nimport * as R from 'ramda';\nimport * as Mutations from '@/store.mutations';\nimport { forEach, get } from 'lodash';\nimport { UserStore } from '@/stores/UserStore';\nimport { UsersStore } from '@/users/UsersStore';\nimport { AppointmentStore } from '@/appointments/AppointmentStore';\nimport { TenantsStore } from '@/tenants/TenantsStore';\nimport { FeedStore } from '@/stores/FeedStore';\nimport { ClaimStore } from '@/stores/ClaimStore';\nimport { ContentStore } from '@/content/ContentStore';\nimport { storage } from '@/api/storage';\nimport { SecurityService } from '@/security/SecurityService';\nimport { CurriculumStore } from '@/curriculum/CurriculumStore'; // import vuexCache from 'vuex-cache'\n\nvar VUE_APP_API_ENDPOINT = process.env.VUE_APP_API_ENDPOINT;\nVue.use(Vuex);\nexport var StoreGetters = {\n  access: 'store:getAccess',\n  permission: 'store:getPermissions'\n};\nexport var Actions = {\n  FILE_UPLOAD: 'fileUpload',\n  GET_UPLOAD_DESTINATION: 'fileUploadDestination',\n  REFRESH_ACCESS: 'root:refreshAccess'\n};\nexport var StoreActions = Actions;\nvar store = new Vuex.Store({\n  state: {\n    access: SecurityService.modelAccess()\n  },\n  plugins: [// vuexCache,\n  function (store) {\n    store.commit(Mutations.INIT);\n    store.subscribe(function (mutation, state) {\n      localStorage.setItem('store', JSON.stringify(state));\n    });\n  }],\n  modules: {\n    user: UserStore,\n    feed: FeedStore,\n    claim: ClaimStore,\n    users: UsersStore,\n    tenants: TenantsStore,\n    appts: AppointmentStore,\n    content: ContentStore,\n    curriculum: CurriculumStore\n  },\n  mutations: (_mutations = {}, _defineProperty(_mutations, Mutations.SET, function (state, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        value = _ref2[0],\n        fn = _ref2[1];\n\n    return fn(state, value);\n  }), _defineProperty(_mutations, Mutations.INIT, function (state) {\n    if (localStorage.getItem('store')) {\n      var hydratedState = JSON.parse(localStorage.getItem('store'));\n      var jwt = hydratedState && hydratedState.user && hydratedState.user.jwt;\n      axios.interceptors.request.use(function (config) {\n        if (jwt && config.url.indexOf(VUE_APP_API_ENDPOINT) > -1) {\n          config.headers['Authorization'] = \"Bearer \".concat(jwt);\n        }\n\n        return config;\n      });\n      var principal = R.path(['user', 'principal'], hydratedState);\n      hydratedState.access = SecurityService.modelAccess(principal);\n      this.replaceState(Object.assign(state, hydratedState));\n    }\n  }), _mutations),\n  actions: (_actions = {}, _defineProperty(_actions, Actions.FILE_UPLOAD, function (context, _ref3) {\n    var file = _ref3.file,\n        destination = _ref3.destination;\n    var config = {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    };\n    var formData = new FormData();\n    forEach(destination.fields, function (f) {\n      formData.set(f.name, f.value);\n    });\n    formData.set('file', file);\n    return axios({\n      method: 'post',\n      url: destination.url,\n      data: formData,\n      config: config\n    });\n  }), _defineProperty(_actions, Actions.GET_UPLOAD_DESTINATION, function () {\n    var _ref4 = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee(context, obj) {\n      var tenantId, dest;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              tenantId = context.state.user.principal.tenantId;\n              _context.next = 3;\n              return storage.createDestination(tenantId);\n\n            case 3:\n              dest = _context.sent;\n              return _context.abrupt(\"return\", dest);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }()), _defineProperty(_actions, Actions.REFRESH_ACCESS, function () {\n    var _ref6 = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee2(_ref5) {\n      var state, commit, principal, access;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              state = _ref5.state, commit = _ref5.commit;\n              principal = R.path(['user', 'principal'], state);\n              access = SecurityService.modelAccess(principal);\n              commit(Mutations.SET, [{\n                access: access\n              }, function (state, value) {\n                return Object.assign(state, value);\n              }]);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x3) {\n      return _ref6.apply(this, arguments);\n    };\n  }()), _actions),\n  getters: (_getters = {}, _defineProperty(_getters, StoreGetters.access, function (state) {\n    return state.access;\n  }), _defineProperty(_getters, StoreGetters.permissions, function (state) {\n    return get(state, 'user.principal.permissions', []);\n  }), _getters)\n});\nexport default store;",{"version":3,"sources":["/Users/narfdre/Code/hexly/admin/src/store.js"],"names":["Vue","Vuex","axios","R","Mutations","forEach","get","UserStore","UsersStore","AppointmentStore","TenantsStore","FeedStore","ClaimStore","ContentStore","storage","SecurityService","CurriculumStore","VUE_APP_API_ENDPOINT","process","env","use","StoreGetters","access","permission","Actions","FILE_UPLOAD","GET_UPLOAD_DESTINATION","REFRESH_ACCESS","StoreActions","store","Store","state","modelAccess","plugins","commit","INIT","subscribe","mutation","localStorage","setItem","JSON","stringify","modules","user","feed","claim","users","tenants","appts","content","curriculum","mutations","SET","value","fn","getItem","hydratedState","parse","jwt","interceptors","request","config","url","indexOf","headers","principal","path","replaceState","Object","assign","actions","context","file","destination","formData","FormData","fields","set","f","name","method","data","obj","tenantId","createDestination","dest","getters","permissions"],"mappings":";;;;;;;;AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAO,KAAKC,CAAZ,MAAmB,OAAnB;AACA,OAAO,KAAKC,SAAZ,MAA2B,mBAA3B;AACA,SAASC,OAAT,EAAkBC,GAAlB,QAA6B,QAA7B;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,UAAT,QAA2B,oBAA3B;AACA,SAASC,gBAAT,QAAiC,iCAAjC;AACA,SAASC,YAAT,QAA6B,wBAA7B;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,UAAT,QAA2B,qBAA3B;AACA,SAASC,YAAT,QAA6B,wBAA7B;AACA,SAASC,OAAT,QAAwB,eAAxB;AACA,SAASC,eAAT,QAAgC,4BAAhC;AACA,SAASC,eAAT,QAAgC,8BAAhC,C,CAEA;;IACQC,oB,GAAyBC,QAAQC,G,CAAjCF,oB;AAERjB,IAAIoB,GAAJ,CAAQnB,IAAR;AAEA,OAAO,IAAMoB,eAAe;AAC1BC,UAAQ,iBADkB;AAE1BC,cAAY;AAFc,CAArB;AAKP,OAAO,IAAMC,UAAU;AACrBC,eAAa,YADQ;AAErBC,0BAAwB,uBAFH;AAGrBC,kBAAgB;AAHK,CAAhB;AAKP,OAAO,IAAMC,eAAeJ,OAArB;AAEP,IAAMK,QAAQ,IAAI5B,KAAK6B,KAAT,CAAe;AAC3BC,SAAO;AACLT,YAAQP,gBAAgBiB,WAAhB;AADH,GADoB;AAI3BC,WAAS,CACP;AACA,mBAAS;AACPJ,UAAMK,MAAN,CAAa9B,UAAU+B,IAAvB;AACAN,UAAMO,SAAN,CAAgB,UAACC,QAAD,EAAWN,KAAX,EAAqB;AACnCO,mBAAaC,OAAb,CAAqB,OAArB,EAA8BC,KAAKC,SAAL,CAAeV,KAAf,CAA9B;AACD,KAFD;AAGD,GAPM,CAJkB;AAa3BW,WAAS;AACPC,UAAMpC,SADC;AAEPqC,UAAMjC,SAFC;AAGPkC,WAAOjC,UAHA;AAIPkC,WAAOtC,UAJA;AAKPuC,aAASrC,YALF;AAMPsC,WAAOvC,gBANA;AAOPwC,aAASpC,YAPF;AAQPqC,gBAAYlC;AARL,GAbkB;AAuB3BmC,2DACG/C,UAAUgD,GADb,EACmB,UAACrB,KAAD;AAAA;AAAA,QAASsB,KAAT;AAAA,QAAgBC,EAAhB;;AAAA,WAAwBA,GAAGvB,KAAH,EAAUsB,KAAV,CAAxB;AAAA,GADnB,+BAEGjD,UAAU+B,IAFb,YAEmBJ,KAFnB,EAE0B;AACtB,QAAIO,aAAaiB,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AACjC,UAAMC,gBAAgBhB,KAAKiB,KAAL,CAAWnB,aAAaiB,OAAb,CAAqB,OAArB,CAAX,CAAtB;AACA,UAAMG,MACJF,iBAAiBA,cAAcb,IAA/B,IAAuCa,cAAcb,IAAd,CAAmBe,GAD5D;AAEAxD,YAAMyD,YAAN,CAAmBC,OAAnB,CAA2BxC,GAA3B,CAA+B,kBAAU;AACvC,YAAIsC,OAAOG,OAAOC,GAAP,CAAWC,OAAX,CAAmB9C,oBAAnB,IAA2C,CAAC,CAAvD,EAA0D;AACxD4C,iBAAOG,OAAP,CAAe,eAAf,qBAA4CN,GAA5C;AACD;;AACD,eAAOG,MAAP;AACD,OALD;AAOA,UAAMI,YAAY9D,EAAE+D,IAAF,CAAO,CAAC,MAAD,EAAS,WAAT,CAAP,EAA8BV,aAA9B,CAAlB;AACAA,oBAAclC,MAAd,GAAuBP,gBAAgBiB,WAAhB,CAA4BiC,SAA5B,CAAvB;AAEA,WAAKE,YAAL,CAAkBC,OAAOC,MAAP,CAActC,KAAd,EAAqByB,aAArB,CAAlB;AACD;AACF,GAnBH,cAvB2B;AA4C3Bc,qDACG9C,QAAQC,WADX,EACyB,UAAC8C,OAAD,SAAoC;AAAA,QAAxBC,IAAwB,SAAxBA,IAAwB;AAAA,QAAlBC,WAAkB,SAAlBA,WAAkB;AACzD,QAAMZ,SAAS;AACbG,eAAS;AACP,wBAAgB;AADT;AADI,KAAf;AAKA,QAAMU,WAAW,IAAIC,QAAJ,EAAjB;AACAtE,YAAQoE,YAAYG,MAApB,EAA4B,aAAK;AAC/BF,eAASG,GAAT,CAAaC,EAAEC,IAAf,EAAqBD,EAAEzB,KAAvB;AACD,KAFD;AAGAqB,aAASG,GAAT,CAAa,MAAb,EAAqBL,IAArB;AAEA,WAAOtE,MAAM;AACX8E,cAAQ,MADG;AAEXlB,WAAKW,YAAYX,GAFN;AAGXmB,YAAMP,QAHK;AAIXb;AAJW,KAAN,CAAP;AAMD,GAnBH,6BAoBGrC,QAAQE,sBApBX;AAAA;AAAA;AAAA,4BAoBoC,iBAAO6C,OAAP,EAAgBW,GAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACxBC,sBADwB,GACXZ,QAAQxC,KAAR,CAAcY,IAAd,CAAmBsB,SADR,CACxBkB,QADwB;AAAA;AAAA,qBAEbrE,QAAQsE,iBAAR,CAA0BD,QAA1B,CAFa;;AAAA;AAE1BE,kBAF0B;AAAA,+CAGzBA,IAHyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KApBpC;;AAAA;AAAA;AAAA;AAAA,kCAyBG7D,QAAQG,cAzBX;AAAA;AAAA;AAAA,4BAyB4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAASI,mBAAT,SAASA,KAAT,EAAgBG,MAAhB,SAAgBA,MAAhB;AAClB+B,uBADkB,GACN9D,EAAE+D,IAAF,CAAO,CAAC,MAAD,EAAS,WAAT,CAAP,EAA8BnC,KAA9B,CADM;AAElBT,oBAFkB,GAETP,gBAAgBiB,WAAhB,CAA4BiC,SAA5B,CAFS;AAGxB/B,qBAAO9B,UAAUgD,GAAjB,EAAsB,CACpB;AAAE9B;AAAF,eADoB,EAEpB,UAACS,KAAD,EAAQsB,KAAR;AAAA,uBAAkBe,OAAOC,MAAP,CAActC,KAAd,EAAqBsB,KAArB,CAAlB;AAAA,eAFoB,CAAtB;;AAHwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAzB5B;;AAAA;AAAA;AAAA;AAAA,iBA5C2B;AA8E3BiC,qDACGjE,aAAaC,MADhB,EACyB;AAAA,WAASS,MAAMT,MAAf;AAAA,GADzB,6BAEGD,aAAakE,WAFhB,EAE8B;AAAA,WAASjF,IAAIyB,KAAJ,EAAW,4BAAX,EAAyC,EAAzC,CAAT;AAAA,GAF9B;AA9E2B,CAAf,CAAd;AAoFA,eAAeF,KAAf","sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport axios from 'axios'\nimport * as R from 'ramda'\nimport * as Mutations from '@/store.mutations'\nimport { forEach, get } from 'lodash'\nimport { UserStore } from '@/stores/UserStore'\nimport { UsersStore } from '@/users/UsersStore'\nimport { AppointmentStore } from '@/appointments/AppointmentStore'\nimport { TenantsStore } from '@/tenants/TenantsStore'\nimport { FeedStore } from '@/stores/FeedStore'\nimport { ClaimStore } from '@/stores/ClaimStore'\nimport { ContentStore } from '@/content/ContentStore'\nimport { storage } from '@/api/storage'\nimport { SecurityService } from '@/security/SecurityService'\nimport { CurriculumStore } from '@/curriculum/CurriculumStore'\n\n// import vuexCache from 'vuex-cache'\nconst { VUE_APP_API_ENDPOINT } = process.env\n\nVue.use(Vuex)\n\nexport const StoreGetters = {\n  access: 'store:getAccess',\n  permission: 'store:getPermissions'\n}\n\nexport const Actions = {\n  FILE_UPLOAD: 'fileUpload',\n  GET_UPLOAD_DESTINATION: 'fileUploadDestination',\n  REFRESH_ACCESS: 'root:refreshAccess'\n}\nexport const StoreActions = Actions\n\nconst store = new Vuex.Store({\n  state: {\n    access: SecurityService.modelAccess()\n  },\n  plugins: [\n    // vuexCache,\n    store => {\n      store.commit(Mutations.INIT)\n      store.subscribe((mutation, state) => {\n        localStorage.setItem('store', JSON.stringify(state))\n      })\n    }\n  ],\n  modules: {\n    user: UserStore,\n    feed: FeedStore,\n    claim: ClaimStore,\n    users: UsersStore,\n    tenants: TenantsStore,\n    appts: AppointmentStore,\n    content: ContentStore,\n    curriculum: CurriculumStore\n  },\n  mutations: {\n    [Mutations.SET]: (state, [value, fn]) => fn(state, value),\n    [Mutations.INIT](state) {\n      if (localStorage.getItem('store')) {\n        const hydratedState = JSON.parse(localStorage.getItem('store'))\n        const jwt =\n          hydratedState && hydratedState.user && hydratedState.user.jwt\n        axios.interceptors.request.use(config => {\n          if (jwt && config.url.indexOf(VUE_APP_API_ENDPOINT) > -1) {\n            config.headers['Authorization'] = `Bearer ${jwt}`\n          }\n          return config\n        })\n\n        const principal = R.path(['user', 'principal'], hydratedState)\n        hydratedState.access = SecurityService.modelAccess(principal)\n\n        this.replaceState(Object.assign(state, hydratedState))\n      }\n    }\n  },\n  actions: {\n    [Actions.FILE_UPLOAD]: (context, { file, destination }) => {\n      const config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }\n      const formData = new FormData()\n      forEach(destination.fields, f => {\n        formData.set(f.name, f.value)\n      })\n      formData.set('file', file)\n\n      return axios({\n        method: 'post',\n        url: destination.url,\n        data: formData,\n        config\n      })\n    },\n    [Actions.GET_UPLOAD_DESTINATION]: async (context, obj) => {\n      const { tenantId } = context.state.user.principal\n      const dest = await storage.createDestination(tenantId)\n      return dest\n    },\n    [Actions.REFRESH_ACCESS]: async ({ state, commit }) => {\n      const principal = R.path(['user', 'principal'], state)\n      const access = SecurityService.modelAccess(principal)\n      commit(Mutations.SET, [\n        { access },\n        (state, value) => Object.assign(state, value)\n      ])\n    }\n  },\n  getters: {\n    [StoreGetters.access]: state => state.access,\n    [StoreGetters.permissions]: state => get(state, 'user.principal.permissions', [])\n  }\n})\n\nexport default store\n"]}]}